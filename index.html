<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enquiries | EYES OF 3080</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin: 0;
  font-family: Segoe UI, Tahoma, sans-serif;
  background: linear-gradient(135deg, #f0fdf4, #dcfce7);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  padding: 16px;
  box-sizing: border-box;
}

/* Wrapper ensures full width responsiveness */
.wrapper {
  width: 100%;
  max-width: 480px;
}

/* Card styling */
.card {
  background: #fff;
  width: 100%;
  padding: 26px;
  border-radius: 20px;
  box-shadow: 0 15px 40px rgba(0,0,0,.12);
  margin-bottom: 20px;
  box-sizing: border-box;
}

/* Logo */
.logo {
  display:block;
  width: 60px;
  height: 60px;
  object-fit: contain;
  margin: 0 auto 16px;
}

/* Headings */
h2 {
  margin: 0 0 6px;
  color: #14532d;
  text-align: center;
}

p.sub {
  margin: 0 0 20px;
  color: #555;
  font-size: .9rem;
  text-align: center;
}

/* Form elements */
textarea {
  width: 100%;
  min-height: 120px;
  resize: vertical;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  font-size: .95rem;
  outline: none;
  box-sizing: border-box;
}

textarea:focus {
  border-color: #22c55e;
}

.upload {
  margin-top: 14px;
}

.upload label {
  display: block;
  font-size: .85rem;
  margin-bottom: 6px;
  color: #374151;
}

input[type="file"] {
  width: 100%;
  box-sizing: border-box;
}

button {
  margin-top: 20px;
  width: 100%;
  background: #22c55e;
  color: #fff;
  padding: 14px;
  border: none;
  border-radius: 14px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  box-sizing: border-box;
}

button:hover {
  background: #16a34a;
}

button:disabled {
  background: #9ca3af;
  cursor: not-allowed;
}

/* Thank you card */
.thank-you {
  text-align: center;
  padding: 30px 10px;
}

.thank-you h3 {
  color: #14532d;
}

.thank-you p {
  color: #555;
  font-size: .95rem;
}
</style>
</head>

<body>

<div class="wrapper">

  <!-- FORM CARD -->
  <div class="card" id="formCard">
    <img src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg" class="logo">

    <h2>Send an Enquiry</h2>
    <p class="sub">Share your concern or message. You can attach a file if needed.</p>

    <textarea id="message" placeholder="Type your message here..."></textarea>

    <div class="upload">
      <label>Attach a file (optional)</label>
      <input type="file" id="file">
    </div>

    <button id="sendBtn">Send Enquiry</button>
  </div>

  <!-- THANK YOU CARD -->
  <div class="card thank-you" id="thanksCard" style="display:none;">
    <img src="https://zvnovocoayqomdilidte.supabase.co/storage/v1/object/public/uploads/6a8f3e57-3d27-47f5-9b5e-22a7070fc442.jpeg" class="logo">

    <h3>Thank you!</h3>
    <p>Your enquiry has been sent successfully.<br>We’ll reply to you shortly.</p>
  </div>

</div>

<script>
const supabaseClient = supabase.createClient(
  "https://zvnovocoayqomdilidte.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2bm92b2NvYXlxb21kaWxpZHRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMDM2OTgsImV4cCI6MjA3OTU3OTY5OH0.PcpwASQ3RBRoQVIglxKz-yM3iuYMZMtyQJBh8QNHad8"
);

const btn = document.getElementById("sendBtn");

btn.addEventListener("click", async () => {
  const message = document.getElementById("message").value.trim();
  const file = document.getElementById("file").files[0];

  if (!message) {
    alert("Please enter a message");
    return;
  }

  btn.textContent = "Sending...";
  btn.disabled = true;

  let fileUrl = null;

  try {
    if (file) {
      const fileName = `${Date.now()}-${file.name}`;

      const { error: uploadError } = await supabaseClient
        .storage
        .from("uploads")   // ✅ Updated bucket name
        .upload(fileName, file);

      if (uploadError) throw uploadError;

      const { data } = supabaseClient
        .storage
        .from("uploads")   // ✅ Updated bucket name
        .getPublicUrl(fileName);

      fileUrl = data.publicUrl;
    }

    const { error } = await supabaseClient.from("enquiries").insert([{
      message: message,
      file_url: fileUrl
    }]);

    if (error) throw error;

    document.getElementById("formCard").style.display = "none";
    document.getElementById("thanksCard").style.display = "block";

  } catch (err) {
    console.error(err);
    alert("Failed to send enquiry. Try again.");
    btn.textContent = "Send Enquiry";
    btn.disabled = false;
  }
});
</script>

</body>
</html>
